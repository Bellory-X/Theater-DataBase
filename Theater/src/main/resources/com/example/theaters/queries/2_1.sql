SELECT COUNT(*)
FROM Репертуары, Пьесы,
     (SELECT Спектакли.Id, Спектакли.Id_Пьесы, Спектакли.Id_Репертуара
      FROM Спектакли, Залы
      WHERE Спектакли.Id = Залы.Id_Спектакля
        AND Залы.Начало::DATE >= '#'
        AND Залы.Начало::DATE <= '#'
      GROUP BY Спектакли.Id) AS cp
WHERE Пьесы.Id = cp.Id_Пьесы
  AND Репертуары.Id = cp.Id_Репертуара
  AND Репертуары.Номер = #
  AND Пьесы.Жанр = '#'
  AND Репертуары.Театр = '#'